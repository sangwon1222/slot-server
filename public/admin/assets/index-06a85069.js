import{f as k,r as b,g as C,o as L,h as S,l as x,j as i,u as r,n,X as K,q as N}from"./index-8e7e92d0.js";import{_ as c}from"./aButton.vue_vue_type_script_setup_true_lang-4e9ddeea.js";import{d,g as p,c as u}from"./index-102bb0cb.js";import"./index-0c264f6f.js";const O={class:"relative flex w-full gap-[10px] py-[10px]"},R={class:"flex gap-[10px] p-[10px]"},B={class:"flex flex-col flex-wrap items-center"},P=k({__name:"index",setup(E){const e=b({rowData:[],gridApi:null,colApi:null,isOpenCreatePop:!1,isOpenInqueryPop:!1,prizeName:"",totalTurn:0,totalScore:0}),v=async({api:o,columnApi:a})=>{e.gridApi=o,e.colApi=a,await g()},g=async()=>{e.gridApi.showLoadingOverlay();const{data:o}=await p.getScore();e.rowData=o,o.length===0?e.gridApi.showNoRowsOverlay():e.gridApi.hideOverlay()},_=d(()=>{e.rowData=[{idx:null,score:"",first:"",second:"",third:"",fourth:""},...e.rowData],e.gridApi.setGridOption("rowData",e.rowData)},500,{trailing:!1,leading:!0}),D=d(async()=>{n.isLoading=!0;const o=e.gridApi.getSelectedRows(),a=K(o,t=>t.idx),l=N(a,t=>t.idx);if(a.length){const{data:t}=await p.deleteScore(l);console.error(t)}e.gridApi.applyTransaction({remove:o});const s=[];e.gridApi.forEachNode(({data:t})=>s.push(t)),e.rowData=s,n.isLoading=!1},500,{trailing:!1,leading:!0}),A=d(async()=>{if(!(e.rowData.length<1))try{n.isLoading=!0;const o={id:-1,colKey:""},a=[];e.gridApi.forEachNode(({id:l,data:s})=>{const{score:t,first:f,second:w,third:y,fourth:m}=s;if(!o.colKey&&!s.idx){const h=t>=0&&f&&w&&y&&m;o.id=h?-1:+l,o.colKey=h?"":"score",a.push({score:t.toString(),first:f,second:w,third:y,fourth:m})}}),o.colKey?e.gridApi.startEditingCell({rowIndex:o.id,colKey:o.colKey}):(await p.addScore(a)).ok&&await g()}catch(o){console.error(o)}finally{n.isLoading=!1}},500,{trailing:!0,leading:!1});return(o,a)=>{const l=C("ag-grid-vue");return L(),S("div",O,[x("div",R,[i(c,{label:"추가","default-style":"p-[10px] rounded bg-gray-600 text-white",onClick:r(_)},null,8,["onClick"]),i(c,{label:"삭제","default-style":"p-[10px] rounded bg-gray-600 text-white",onClick:r(D)},null,8,["onClick"]),i(c,{label:"저장","default-style":"p-[10px] rounded bg-gray-600 text-white",onClick:r(A)},null,8,["onClick"])]),x("div",B,[i(l,{"default-col-def":{suppressMenu:!0,resizable:!0,sortable:!0},"column-defs":r(u).scoreList,"row-data":e.rowData,"row-selection":"multiple","stop-editing-when-cells-lose-focus":"",class:"ag-theme-quartz h-[400px] w-full","animate-rows":"","suppress-drag-leave-hides-columns":"","suppress-scroll-on-new-data":"","suppress-row-click-selection":"","single-click-edit":"","row-multi-select-with-click":"","overlay-no-rows-template":r(u).overlay("noRows"),"overlay-loading-template":r(u).overlay("loading"),"get-row-style":({data:s})=>s.idx?{background:"#2DD4BF"}:{},onGridReady:v},null,8,["column-defs","row-data","overlay-no-rows-template","overlay-loading-template","get-row-style"])])])}}});export{P as default};
