import{S as F,i as M,a as oe,b as ne,c as ae,d as re,e as le,k as se,f as R,r as S,g as K,o as z,h as N,j as c,l as v,F as ie,m as ue,u as k,t as B,n as m,p as _,q,s as de,v as ce,w as L,x as pe,y as fe,z as E,A as T}from"./index-8e7e92d0.js";import{b as ge,_ as U,r as me,p as xe,i as we,a as ve}from"./aSvgButton.vue_vue_type_script_setup_true_lang-6054c157.js";import{g as C,c as G,d as he}from"./index-102bb0cb.js";import{_ as P}from"./aButton.vue_vue_type_script_setup_true_lang-4e9ddeea.js";import{_ as b}from"./aInput.vue_vue_type_script_setup_true_lang-1f96e257.js";import{a as Z}from"./auth-5938e945.js";import"./index-0c264f6f.js";function ye(o,a){var e=-1,n=o.length;for(a||(a=Array(n));++e<n;)a[e]=o[e];return a}var Y=F?F.isConcatSpreadable:void 0;function be(o){return M(o)||oe(o)||!!(Y&&o&&o[Y])}function Q(o,a,e,n,u){var t=-1,x=o.length;for(e||(e=be),u||(u=[]);++t<x;){var g=o[t];a>0&&e(g)?a>1?Q(g,a-1,e,n,u):ne(u,g):n||(u[u.length]=g)}return u}function H(o){var a=o==null?0:o.length;return a?Q(o,1):[]}function Ce(o,a,e,n){for(var u=-1,t=o==null?0:o.length;++u<t;){var x=o[u];a(n,x,e(x),o)}return n}function _e(o,a,e,n){return ae(o,function(u,t,x){a(n,u,e(u),x)}),n}function ke(o,a){return function(e,n){var u=M(e)?Ce:_e,t=a?a():{};return u(e,o,re(n),t)}}var ze=Object.prototype,Ge=ze.hasOwnProperty,Ie=ke(function(o,a,e){Ge.call(o,e)?o[e].push(a):ge(o,e,[a])});const De=Ie;function Pe(o,a){return le(a,function(e){return o[e]})}function W(o){return o==null?[]:Pe(o,se(o))}var $e=Math.floor,Ae=Math.random;function X(o,a){return o+$e(Ae()*(a-o+1))}function ee(o){var a=o.length;return a?o[X(0,a-1)]:void 0}function Ne(o){return ee(W(o))}function Oe(o){var a=M(o)?ee:Ne;return a(o)}function te(o,a){var e=-1,n=o.length,u=n-1;for(a=a===void 0?n:a;++e<a;){var t=X(e,u),x=o[t];o[t]=o[e],o[e]=x}return o.length=a,o}function Le(o){return te(ye(o))}function Re(o){return te(W(o))}function J(o){var a=M(o)?Le:Re;return a(o)}const Se={class:"fixed left-0 top-0 z-[3] flex h-screen w-screen items-center justify-center"},Ee={class:"relative z-[2] flex h-fit max-h-[800px] w-full max-w-[800px] flex-col gap-[4px] rounded bg-white p-[10px]"},Te={class:"flex"},qe={class:"my-[10px] flex gap-[2px] overflow-x-auto"},Me=["onClick"],Ke={class:"flex flex-col gap-[10px] rounded-xl border p-[10px] shadow-md duration-75"},Ve={class:"flex"},je={class:"flex justify-end gap-[10px]"},Be={class:"border p-[10px]"},Ue={class:"flex gap-[10px] py-[10px]"},Fe=R({__name:"tInqueryGamePop",props:{info:{default:()=>({name:"",turnCount:0,score:0,percentage:"0"})}},emits:["close"],setup(o,{emit:a}){const e=o,n=S({gridApi:null,totalData:{},sumData:[],prizeData:[],currentGroupIndex:0,groupCount:0}),u=async({api:p})=>{var d,i;m.isLoading=!0;const{ok:s,data:h,msg:I}=await C.getGame(e.info.name);s?(n.totalData=De(h,r=>r.groupIdx),n.prizeData=n.totalData[n.currentGroupIndex],n.groupCount=(d=h[0])!=null&&d.groupCount?(i=h[0])==null?void 0:i.groupCount:0,await t(h),n.gridApi=p):(await C.deleteGame(e.info.name),console.log(e.info),console.log(I),_.error(I),g("close")),m.isLoading=!1},t=async p=>{q(p,s=>{n.sumData[s.groupIdx]?(n.sumData[s.groupIdx].score+=s.score,n.sumData[s.groupIdx].turnCount+=s.turnCount):n.sumData[s.groupIdx]={score:s.score,turnCount:s.turnCount}}),q(n.sumData,s=>{s.percentage=de(s.score,s.turnCount)})},x=p=>{p<0||p>=n.groupCount||(n.currentGroupIndex=p,n.prizeData=n.totalData[n.currentGroupIndex])},g=a;return(p,s)=>{var I,d,i;const h=K("ag-grid-vue");return z(),N("div",Se,[c(U,{"is-show":""}),v("div",Ee,[v("div",Te,[c(b,{"init-value":e.info.name,label:"게임 이름","default-style":"!w-full",readonly:""},null,8,["init-value"]),c(b,{"init-value":`${n.groupCount}`,"default-style":"!w-full",label:"전체 그룹",readonly:""},null,8,["init-value"]),c(b,{"init-value":`${e.info.turnCount}`,"default-style":"!w-full",label:"전체 턴 수",readonly:""},null,8,["init-value"]),c(b,{"init-value":`${e.info.score}`,"default-style":"!w-full",label:"총 점수",readonly:""},null,8,["init-value"]),c(b,{"init-value":`${e.info.percentage}`,"default-style":"!w-full",label:"총 확률",readonly:""},null,8,["init-value"])]),v("div",qe,[(z(!0),N(ie,null,ue(n.sumData,(r,l)=>(z(),N("button",{key:l,class:ce(["border px-[10px] duration-300",l==n.currentGroupIndex?"bg-teal-400":"bg-white"]),onClick:f=>x(l)},B(l+1)+" GROUP ",11,Me))),128))]),v("div",Ke,[v("div",Ve,[c(b,{"init-value":`${n.currentGroupIndex+1}`,"default-style":"!w-full",label:"현재 그룹",readonly:""},null,8,["init-value"]),c(b,{"init-value":`${(I=n.sumData[n.currentGroupIndex])==null?void 0:I.score}`,"default-style":"!w-full",label:"그룹 점수",readonly:""},null,8,["init-value"]),c(b,{"init-value":`${(d=n.sumData[n.currentGroupIndex])==null?void 0:d.turnCount}`,"default-style":"!w-full",label:"그룹 턴 수",readonly:""},null,8,["init-value"]),c(b,{"init-value":`${(i=n.sumData[n.currentGroupIndex])==null?void 0:i.percentage} %`,"default-style":"!w-full",label:"현재 그룹 확률",readonly:""},null,8,["init-value"])]),c(h,{class:"ag-theme-quartz h-[400px] w-full","row-data":n.prizeData,"stop-editing-when-cells-lose-focus":"","default-col-def":{suppressMenu:!0,resizable:!1,sortable:!1,editable:!1},"column-defs":k(G).gameDetail,"overlay-no-rows-template":k(G).overlay("noRows","[ PRIZE ] 값이 없습니다."),"overlay-loading-template":k(G).overlay("loading"),"get-row-style":({data:r})=>r.outScore?{background:"#2DD4BF"}:{},onGridReady:u},null,8,["row-data","column-defs","overlay-no-rows-template","overlay-loading-template","get-row-style"]),v("div",je,[v("button",{onClick:s[0]||(s[0]=r=>x(n.currentGroupIndex-1))},"이전"),v("p",Be,B(n.currentGroupIndex+1)+" / "+B(n.groupCount),1),v("button",{onClick:s[1]||(s[1]=r=>x(n.currentGroupIndex+1))},"다음")])]),v("div",Ue,[c(P,{label:"닫기","default-style":"flex-1 bg-gray-600 p-[10px] rounded text-white hover:bg-main-1 duration-100",onOnClick:s[2]||(s[2]=r=>p.$emit("close"))})])])])}}}),Ze={class:"fixed left-0 top-0 z-[3] flex h-screen w-screen items-center justify-center"},Ye={class:"relative z-[2] flex h-full max-h-[800px] w-full max-w-[800px] flex-col rounded bg-white p-[10px]"},He={class:"flex flex-col gap-[10px] rounded-xl border p-[10px] shadow-md"},Je={class:"flex gap-[10px] py-[10px]"},Qe=R({__name:"tCreateGamePop",emits:["close","create"],setup(o,{emit:a}){const e=L(null),n=L(null),u=L(null),t=S({gridApi:null,gameName:"",formatTurnCount:"0",groupCount:"0",turnCount:pe(()=>+t.formatTurnCount.replaceAll(",","")),prizeData:[]}),x=async({api:i})=>{m.isLoading=!0,t.prizeData=[{prizeCount:0,score:"선택"}],e.value.focus(),t.gridApi=i,m.isLoading=!1},g=async()=>{if(t.gridApi.stopEditing(),!t.gameName)return _.error("이름을 작성해주세요."),e.value.focus(),!1;if(!t.turnCount)return _.error("턴 수를 작성해주세요."),n.value.focus(),!1;if(!+t.groupCount)return _.error("그룹 수를 작성해주세요."),u.value.select(),!1;const i={id:-1,colKey:""};return t.gridApi.forEachNode(({data:l,id:f})=>{i.id>-1||(!l.prizeCount||l.score=="선택")&&(i.id=+f,i.colKey=l.prizeCount?"score":"prizeCount")}),i.id>-1?(t.gridApi.startEditingCell({rowIndex:i.id,colKey:i.colKey}),_.error("grid 입력폼을 작성해주세요."),!1):(await C.getGame(t.gameName)).ok?(_.error("중복된 이름입니다."),e.value.select(),!1):!0},p=async()=>{if(await g())try{m.process.total=t.groupCount,m.isProcess=!0,m.isLoading=!0;const r=await s();if(!r.ok)return _.error(r.msg);const l=[];for(let w=0;w<r.data.length;w++){const A=q(r.data[w],$=>($.groupIdx=w%t.groupCount,$.groupCount=+t.groupCount,$));l[w%t.groupCount]?l[w%t.groupCount].push([...A]):l[w%t.groupCount]=[[...A]]}const f=t.turnCount-r.prizeTurnCount<=0?0:t.turnCount-r.prizeTurnCount,y=Math.ceil(f/t.groupCount),D=f-y*(t.groupCount-1);for(let w=0;w<l.length;w++){if(m.process.current=w+1,f>0){const $=l[w].length;let O=w==l.length-1?D:y;for(let V=0;V<$+1;V++){const j=V==$||O<2?O:Math.ceil(Math.random()*O);if(O-=j,O<0||j==0)break;l[w].push({score:0,turnCount:j,Ycode:"-",Pcode:"-",name:"-",outScore:0,groupIdx:w,groupCount:+t.groupCount})}}const A=J(l[w]);l[w]=H(A)}d("create",{name:t.gameName,turnCount:t.turnCount,score:r.totalScore,list:l})}catch(r){console.log(r),_.error("에러",r),m.isLoading=!1,m.isProcess=!1}},s=async()=>{const i=[],{length:r}=t.prizeData;for(let y=0;y<r;y++){const{data:D}=await C.getRandomPrize(t.prizeData[y].score),w=D;for(let A=0;A<t.prizeData[y].prizeCount;A++){const $=await C.getPrize(Oe(w));i.push($.data)}}const l=me(H(i),(y,D,w)=>({turnCount:y.turnCount+D.turnCount,score:y.score+D.score}),{turnCount:0,score:0}),f=l.turnCount>t.turnCount?{ok:!1,data:[],totalScore:0,msg:"턴 수 초과",prizeTurnCount:0}:{ok:!0,data:J(i),totalScore:l.score,prizeTurnCount:l.turnCount,msg:"턴 수 초과"};return console.log(`ONLY PRIZE TURN [ ${l.turnCount} ]`),f},h=()=>{t.gridApi.stopEditing(),t.prizeData.push({prizeCount:0,score:"선택"}),t.gridApi.setGridOption("rowData",t.prizeData),t.gridApi.startEditingCell({rowIndex:t.prizeData.length-1,colKey:"score"})},I=i=>{const r=[];t.gridApi.forEachNode(({data:l,id:f})=>{f!=i&&r.push(l)}),t.prizeData=r,t.gridApi.setGridOption("rowData",t.prizeData)},d=a;return(i,r)=>{const l=K("ag-grid-vue");return z(),N("div",Ze,[c(U,{"is-show":""}),v("div",Ye,[c(b,{ref_key:"refNameInput",ref:e,"model-value":t.gameName,"onUpdate:modelValue":r[0]||(r[0]=f=>t.gameName=f),label:"이름","default-style":"!w-full","data-binding":"upper not-symbol",onKeydownEnter:r[1]||(r[1]=f=>n.value.focus())},null,8,["model-value"]),c(b,{ref_key:"refTurnInput",ref:n,"model-value":t.formatTurnCount,"onUpdate:modelValue":r[2]||(r[2]=f=>t.formatTurnCount=f),"default-style":"!w-full",label:"전체 턴 수","data-binding":"price",onKeydownEnter:r[3]||(r[3]=f=>u.value.focus())},null,8,["model-value"]),c(b,{ref_key:"refGroupInput",ref:u,"model-value":t.groupCount,"onUpdate:modelValue":r[4]||(r[4]=f=>t.groupCount=f),"default-style":"!w-full",label:"그룹 수",type:"number",onKeydownEnter:r[5]||(r[5]=()=>t.gridApi.startEditingCell({rowIndex:0,colKey:"score"}))},null,8,["model-value"]),v("div",He,[c(l,{class:"ag-theme-quartz h-[400px] w-full","row-data":t.prizeData,"stop-editing-when-cells-lose-focus":"","default-col-def":{suppressMenu:!0,resizable:!1,sortable:!1,editable:!0},"column-defs":k(G).gameSelectPrize,"single-click-edit":"","overlay-no-rows-template":k(G).overlay("noRows","[ PRIZE ] 값이 없습니다."),"overlay-loading-template":k(G).overlay("loading"),context:{btnClickevent:I},onGridReady:x},null,8,["row-data","column-defs","overlay-no-rows-template","overlay-loading-template","context"]),c(P,{label:"행 추가","default-style":"w-full bg-main-2 p-[10px] rounded text-white hover:bg-main-1 duration-100",onOnClick:h})]),v("div",Je,[c(P,{label:"생성","default-style":"flex-1 bg-main-2 p-[10px] rounded text-white hover:bg-main-1 duration-100",onOnClick:p}),c(P,{label:"닫기","default-style":"flex-1 bg-gray-600 p-[10px] rounded text-white hover:bg-main-1 duration-100",onOnClick:r[6]||(r[6]=f=>i.$emit("close"))})])])])}}}),We={class:"fixed left-0 top-0 z-[3] flex h-screen w-screen items-center justify-center"},Xe={class:"relative z-[2] flex h-full max-h-[500px] w-full max-w-[800px] flex-col rounded bg-white p-[10px]"},et={class:"flex w-full flex-col items-center gap-[10px] bg-white p-[10px] shadow-lg"},tt=R({__name:"tRegistGamePop",props:{gameName:{default:""}},emits:["close"],setup(o,{emit:a}){const e=o,n=S({userList:[],gridApi:null});fe(async()=>{m.isLoading=!0;const{list:g}=await Z.getUserList();n.userList=g,m.isLoading=!1});const u=({api:g})=>n.gridApi=g,t=async()=>{const g=n.gridApi.getSelectedRows();if(g.length===1)try{m.isLoading=!0;const p=await Z.registGame({userID:g[0].userID,gameName:e.gameName});console.log(p),p.ok&&x("close")}catch(p){console.log(p)}finally{m.isLoading=!1}},x=a;return(g,p)=>{const s=K("ag-grid-vue");return z(),N("div",We,[c(U,{"is-show":""}),v("div",Xe,[c(s,{class:"ag-theme-quartz h-[400px] w-full","row-data":n.userList,"default-col-def":{suppressMenu:!0,resizable:!1,sortable:!1,editable:!1},"column-defs":[{width:60,checkboxSelection:!0},{field:"userID"},{field:"gameTable"}],"row-selection":"single","overlay-no-rows-template":k(G).overlay("noRows","[ user ] 목록이 없습니다."),"overlay-loading-template":k(G).overlay("loading"),onGridReady:u},null,8,["row-data","overlay-no-rows-template","overlay-loading-template"]),v("div",et,[c(P,{label:"등록","default-style":"flex-1 w-full bg-gray-600 p-[10px] rounded text-white hover:bg-main-1 duration-100",onClick:t}),c(P,{label:"닫기","default-style":"flex-1 w-full bg-gray-600 p-[10px] rounded text-white hover:bg-main-1 duration-100",onOnClick:p[0]||(p[0]=h=>g.$emit("close"))})])])])}}}),ot={class:"relative flex w-full flex-col items-center gap-[10px] pb-[60px]"},nt={class:"grid w-full gap-[4px] p-[4px] mobile:grid-cols-1 tablet:grid-cols-3 desktop:grid-cols-4"},at={class:"absolute bottom-[4px] right-[4px] flex gap-[10px]"},rt=R({__name:"tSearch",emits:["on-search","on-create-game","on-delete","on-use","on-match"],setup(o,{expose:a,emit:e}){const n=e,u=L(null),t=S({gameName:""}),x=()=>{u.value.trim(),t.gameName=t.gameName.trim();const{gameName:p}=t,s=xe({name:p.trim()},(h,I)=>h);we(s)?n("on-search"):n("on-search",s)},g=()=>{t.gameName="",u.value.reset(),u.value.focus()};return a({resetInput:g}),(p,s)=>(z(),N("div",ot,[v("ul",nt,[c(b,{ref_key:"refGameNameInput",ref:u,label:"게임 이름","default-style":"w-full ","model-value":t.gameName,onInput:s[0]||(s[0]=h=>t.gameName=h.target.value),onKeydownEnter:x},null,8,["model-value"])]),v("div",at,[t.gameName?(z(),E(ve,{key:0,name:"refreshIcon","default-style":"flex items-center justify-center !w-[60px] h-[40px] border rounded-xl w-fit mx-auto bg-main-2 hover:bg-main-3 text-white hover:text-black duration-300","svg-fill":"#fff",onClick:g})):T("",!0),c(P,{label:"사용","default-style":"p-[10px] border rounded-xl w-fit mx-auto bg-main-2 hover:bg-main-3 text-white hover:text-black duration-300 ",onClick:s[1]||(s[1]=h=>n("on-use"))}),c(P,{label:"검색","default-style":"p-[10px] border rounded-xl w-fit mx-auto bg-main-2 hover:bg-main-3 text-white hover:text-black duration-300 ",onClick:x}),c(P,{label:"생성","default-style":"p-[10px] border rounded-xl w-fit mx-auto bg-main-2 hover:bg-main-3 text-white hover:text-black duration-300 ",onClick:s[2]||(s[2]=h=>n("on-create-game"))})])]))}}),lt={class:"relative flex w-full gap-[10px] py-[10px]"},st={class:"flex flex-col flex-wrap items-center"},mt=R({__name:"index",setup(o){const a=L(null),e=S({rowData:[],gridApi:null,colApi:null,isOpenCreatePop:!1,isOpenInqueryPop:!1,isOpenRegistPop:!1,detailGameParams:{name:"",turnCount:0,score:0,percentage:""},gameName:""}),n=async({api:d,columnApi:i})=>{e.gridApi=d,e.colApi=i,await u()},u=async()=>{e.gridApi.showLoadingOverlay();const{data:d}=await C.searchGame();e.rowData=d,d.length===0?e.gridApi.showNoRowsOverlay():e.gridApi.hideOverlay()},t=he(async d=>{e.gridApi.showLoadingOverlay();const{data:i}=await C.searchGame(d!=null&&d.name?d.name:null);e.rowData=i,i.length===0?e.gridApi.showNoRowsOverlay():e.gridApi.hideOverlay()},500,{leading:!1,trailing:!0}),x=async()=>{var r;const d=(r=e.gridApi)==null?void 0:r.getSelectedRows(),i=q(d,l=>l.name);if(!(i.length<=0)){m.isLoading=!0;for(let l=0;l<i.length;l++)await C.deleteGame(i[l]);await u(),m.isLoading=!1}},g=async()=>{await C.searchPrizeName(),document.body.classList.add("overflow-hidden"),e.isOpenCreatePop=!0},p=({name:d,turnCount:i,score:r,percentage:l})=>{e.detailGameParams={name:d,turnCount:i,score:r,percentage:l},document.body.classList.add("overflow-hidden"),e.isOpenInqueryPop=!0},s=async()=>{await u(),document.body.classList.remove("overflow-hidden"),e.detailGameParams={name:"",turnCount:0,score:0,percentage:"0"},e.isOpenCreatePop=!1,e.isOpenInqueryPop=!1,e.isOpenRegistPop=!1},h=async({name:d,turnCount:i,score:r,list:l})=>{m.process.total=l.length,m.isProcess=!0,m.isLoading=!0,console.log("index!",l);try{const f=await C.createGame({name:d,turnCount:i,score:r});if(!f.ok)return _.error(f.msg);for(let y=0;y<l.length;y++){m.process.current=y;const D=await C.addGameContents({name:d,list:l[y]});if(!D.ok){await C.deleteGame(d),_.error(D.msg);break}y==l.length-1&&(await u(),a.value.resetInput(),s(),_.success("저장 성공"))}}catch(f){console.log(f),await C.deleteGame(d)}finally{m.isLoading=!1,m.isProcess=!1}},I=()=>{const d=e.gridApi.getSelectedRows();if(d.length!=1){_.error("하나의 행을 선택해 주세요.");return}e.gameName=d[0].name,e.isOpenRegistPop=!0};return(d,i)=>{const r=K("ag-grid-vue");return z(),N("div",lt,[c(rt,{ref_key:"refSearch",ref:a,onOnSearch:k(t),onOnCreateGame:g,onOnUse:I,onOnDelete:x},null,8,["onOnSearch"]),v("div",st,[c(r,{"default-col-def":{suppressMenu:!0,resizable:!0,sortable:!0},"column-defs":k(G).gameList,"stop-editing-when-cells-lose-focus":"","row-data":e.rowData,"row-selection":"multiple",class:"ag-theme-quartz h-[400px] w-full","animate-rows":"","suppress-drag-leave-hides-columns":"","suppress-scroll-on-new-data":"","suppress-row-click-selection":"","row-multi-select-with-click":"",context:{openPop:p},"overlay-no-rows-template":k(G).overlay("noRows"),"overlay-loading-template":k(G).overlay("loading"),onGridReady:n},null,8,["column-defs","row-data","context","overlay-no-rows-template","overlay-loading-template"])]),e.isOpenRegistPop?(z(),E(tt,{key:0,"game-name":e.gameName,onClose:s},null,8,["game-name"])):T("",!0),e.isOpenCreatePop?(z(),E(Qe,{key:1,onClose:s,onCreate:h})):T("",!0),e.isOpenInqueryPop?(z(),E(Fe,{key:2,info:e.detailGameParams,onClose:s},null,8,["info"])):T("",!0)])}}});export{mt as default};
