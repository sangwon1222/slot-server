import{f as k,r as C,g as O,o as h,h as P,j as s,l as f,u as p,p as S,n as _,w as E,z as D,A as N,q as R}from"./index-8e7e92d0.js";import{_ as $,r as G,p as T,i as L,a as q}from"./aSvgButton.vue_vue_type_script_setup_true_lang-6054c157.js";import{c,g as b,d as K}from"./index-102bb0cb.js";import{_ as x}from"./aButton.vue_vue_type_script_setup_true_lang-4e9ddeea.js";import{_ as B}from"./aInput.vue_vue_type_script_setup_true_lang-1f96e257.js";import"./index-0c264f6f.js";const M={class:"fixed left-0 top-0 z-[3] flex h-screen w-screen items-center justify-center"},Z={class:"relative z-[2] flex h-full max-h-[800px] w-full max-w-[800px] flex-col gap-[20px] rounded bg-white p-[10px]"},j={class:"flex flex-1 flex-col flex-wrap items-center"},V={class:"flex flex-col gap-[10px]"},Y=k({__name:"tAddPrizePop",emits:["close"],setup(z,{emit:y}){const e=C({sumGridDef:c.prizeList.slice(3),sumGridApi:null,rowData:[],gridApi:null,colApi:null,name:"",totalTurn:0,totalScore:0}),r=t=>{e.name=t.value,t.value&&u(),e.gridApi.startEditingCell({rowIndex:0,colKey:"score"})},n=({api:t})=>e.sumGridApi=t,g=async({api:t,columnApi:l})=>{e.gridApi=t,e.colApi=l,e.sumGridApi.startEditingCell({rowIndex:0,colKey:"name"})},u=()=>{if(e.gridApi.stopEditing(),!e.name)return e.sumGridApi.stopEditing(),e.sumGridApi.startEditingCell({rowIndex:0,colKey:"name"}),S.error("PRIZE 이름을 작성해주세요.");e.rowData.push({name:e.name,Pcode:"",Ycode:"",score:0,turnCount:0}),e.gridApi.setGridOption("rowData",e.rowData),e.gridApi.startEditingCell({rowIndex:e.rowData.length-1,colKey:"score"})},i=()=>{e.gridApi.applyTransaction({remove:e.gridApi.getSelectedRows()});const t=[];e.gridApi.forEachNode(({data:l})=>t.push(l)),e.rowData=t},d=()=>{const t=[];e.gridApi.forEachNode(({rowIndex:l,data:w})=>t[l]=w),e.rowData=t,e.gridApi.setGridOption("rowData",t)},o=async()=>{_.isLoading=!0;try{e.gridApi.stopEditing();const t=[];let l=-1;if(e.gridApi.forEachNode(({rowIndex:I,data:v})=>{!+v.turnCount||+v.turnCount<1?l=l==-1?+I:l:t.push({name:e.name,Ycode:v.Ycode,Pcode:v.Pcode,score:+v.score,outScore:e.totalScore,turnCount:+v.turnCount})}),l!=-1){e.gridApi.startEditingCell({rowIndex:l,colKey:"turnCount"});return}if(t.length<=0){S.error("하나 이상의 행을 입력해주세요.");return}if((await b.searchPrizeName(e.name)).data.length>0){S.error("PRIZE 이름을 변경해주세요."),e.sumGridApi.startEditingCell({rowIndex:0,colKey:"name"});return}const A=await b.savePrize(t);A.ok?m("close"):S.error(`저장실패 / ${A.msg}`)}catch(t){console.log(t)}finally{_.isLoading=!1}},a=()=>{const t=G(e.rowData,(l,w,A)=>({totalScore:l.totalScore+w.score,totalTurn:l.totalTurn+w.turnCount}),{totalScore:0,totalTurn:0});e.totalScore=t.totalScore,e.totalTurn=t.totalTurn},m=y;return(t,l)=>{const w=O("ag-grid-vue");return h(),P("div",M,[s($,{"is-show":""}),f("div",Z,[s(w,{"default-col-def":{suppressMenu:!0,resizable:!0,sortable:!1,editable:!1},"column-defs":[{headerName:"PRIZE 이름",field:"name",width:100,editable:!0},{headerName:"전체 턴수",field:"totalTurn",width:100},{headerName:"총 상금",field:"totalScore",width:100}],"stop-editing-when-cells-lose-focus":"","suppress-drag-leave-hides-columns":"","row-style":{background:"#bcbcbc"},class:"ag-theme-quartz h-[104px] w-full p-0","row-data":[{name:e.name,totalTurn:e.totalTurn,totalScore:e.totalScore}],onGridReady:n,onCellEditingStopped:r},null,8,["row-data"]),f("div",j,[s(w,{"default-col-def":{suppressMenu:!0,resizable:!0,sortable:!1},"column-defs":p(c).prizeDetail,"row-data":e.rowData,class:"ag-theme-quartz h-full w-full","stop-editing-when-cells-lose-focus":"","animate-rows":"","suppress-drag-leave-hides-columns":"","suppress-scroll-on-new-data":"","suppress-row-click-selection":"","single-click-edit":"","row-drag-entire-row":"","row-drag-managed":"","row-drag-multi-row":"","enter-navigates-vertically-after-edit":"","enter-navigates-vertically":"","row-selection":"multiple","overlay-no-rows-template":p(c).overlay("noRows","행을 추가하세요."),"overlay-loading-template":p(c).overlay("loading"),onGridReady:g,onRowDragEnd:d,onCellEditingStopped:a},null,8,["column-defs","row-data","overlay-no-rows-template","overlay-loading-template"])]),f("div",V,[s(x,{"default-style":"h-[50px] p-[10px] px-[20px] text-white flex-1 rounded border bg-slate-600",label:"행 추가",onOnClick:u}),s(x,{"default-style":"h-[50px] p-[10px] px-[20px] text-white flex-1 rounded border bg-slate-600",label:"행 삭제",onOnClick:i}),s(x,{"default-style":"h-[50px] p-[10px] px-[20px] text-white flex-1 rounded border bg-slate-600",label:"저장",onOnClick:o}),s(x,{"default-style":"h-[50px] p-[10px] px-[20px] flex-1 rounded border bg-slate-400",label:"닫기",onOnClick:l[0]||(l[0]=A=>t.$emit("close"))})])])])}}}),F={class:"relative flex w-full flex-col items-center gap-[10px] pb-[60px]"},H={class:"grid w-full gap-[4px] p-[4px] mobile:grid-cols-1 tablet:grid-cols-3 desktop:grid-cols-4"},J={class:"absolute bottom-[4px] right-[4px] flex gap-[10px]"},Q=k({__name:"tSearch",emits:["on-search","on-create","on-delete"],setup(z,{expose:y,emit:e}){const r=E(null),n=C({prizeName:""}),g=()=>{n.prizeName=n.prizeName.trim();const{prizeName:d}=n,o=T({name:d.trim()},(a,m)=>a);L(o)?i("on-search"):i("on-search",o)},u=()=>{r.value.reset(),r.value.focus()};y({resetInput:u});const i=e;return(d,o)=>(h(),P("div",F,[f("ul",H,[s(B,{ref_key:"refPrizeNameInput",ref:r,label:"PRIZE 이름","default-style":"w-full","model-value":n.prizeName,onInput:o[0]||(o[0]=a=>n.prizeName=a.target.value),onKeydownEnter:g},null,8,["model-value"])]),f("div",J,[n.prizeName?(h(),D(q,{key:0,name:"refreshIcon","default-style":"flex items-center justify-center !w-[60px] !h-[40px] border rounded-xl w-fit mx-auto bg-main-2 hover:bg-main-3 text-white hover:text-black duration-300","svg-fill":"#fff",onClick:u})):N("",!0),s(x,{label:"검색","default-style":"p-[10px] border rounded-xl w-fit mx-auto bg-main-2 hover:bg-main-3 text-white hover:text-black duration-300 ",onClick:g}),s(x,{label:"생성","default-style":"p-[10px] border rounded-xl w-fit mx-auto bg-main-2 hover:bg-main-3 text-white hover:text-black duration-300 ",onClick:o[1]||(o[1]=a=>d.$emit("on-create",{name:n.prizeName}))}),s(x,{label:"삭제","default-style":"p-[10px] border rounded-xl w-fit mx-auto bg-main-2 hover:bg-main-3 text-white hover:text-black duration-300 ",onClick:o[2]||(o[2]=a=>i("on-delete"))})])]))}}),U={class:"fixed left-0 top-0 z-[3] flex h-screen w-screen items-center justify-center"},W={class:"relative z-[2] flex h-full max-h-[800px] w-full max-w-[800px] flex-col gap-[20px] rounded bg-white p-[10px]"},X={class:"flex flex-1 flex-col flex-wrap items-center"},ee={class:"flex flex-col gap-[10px]"},te=k({__name:"tInqueryPrizePop",props:{name:{default:""},totalTurn:{default:0},totalScore:{default:0}},emits:["close"],setup(z,{emit:y}){const e=z,r=C({sumGridDef:c.prizeList.slice(3),sumGridApi:null,rowData:[],gridApi:null,colApi:null,totalTurn:e.totalTurn,totalScore:e.totalScore}),n=({api:i})=>r.sumGridApi=i,g=async({api:i,columnApi:d})=>{r.gridApi=i,r.colApi=d,await u()},u=async()=>{const{data:i}=await b.getPrize(e.name);r.rowData=i,r.gridApi.setGridOption("rowData",r.rowData)};return(i,d)=>{const o=O("ag-grid-vue");return h(),P("div",U,[s($,{"is-show":""}),f("div",W,[s(o,{"default-col-def":{suppressMenu:!0,resizable:!0,sortable:!1,editable:!1},"column-defs":[{headerName:"PRIZE 이름",field:"name",width:100},{headerName:"전체 턴수",field:"totalTurn",width:100},{headerName:"총 상금",field:"totalScore",width:100}],"stop-editing-when-cells-lose-focus":"","suppress-drag-leave-hides-columns":"","row-style":{background:"#bcbcbc"},class:"ag-theme-quartz h-[104px] w-full p-0","row-data":[{name:e.name,totalTurn:r.totalTurn,totalScore:r.totalScore}],onGridReady:n},null,8,["row-data"]),f("div",X,[s(o,{"default-col-def":{suppressMenu:!0,resizable:!0,sortable:!1,editable:!1},"column-defs":p(c).prizeDetail,"row-data":r.rowData,class:"ag-theme-quartz h-full w-full","stop-editing-when-cells-lose-focus":"","animate-rows":"","suppress-drag-leave-hides-columns":"","suppress-scroll-on-new-data":"","suppress-row-click-selection":"","single-click-edit":"","row-drag-entire-row":"","row-drag-managed":"","row-drag-multi-row":"","enter-navigates-vertically-after-edit":"","enter-navigates-vertically":"","row-selection":"multiple","overlay-no-rows-template":p(c).overlay("noRows","행을 추가하세요."),"overlay-loading-template":p(c).overlay("loading"),onGridReady:g},null,8,["column-defs","row-data","overlay-no-rows-template","overlay-loading-template"])]),f("div",ee,[s(x,{"default-style":"h-[50px] p-[10px] px-[20px] flex-1 rounded border bg-slate-400",label:"닫기",onOnClick:d[0]||(d[0]=a=>i.$emit("close"))})])])])}}}),oe={class:"relative flex w-full gap-[10px] py-[10px]"},ae={class:"flex flex-col flex-wrap items-center"},ce=k({__name:"index",setup(z){const y=E(null),e=C({rowData:[],gridApi:null,colApi:null,isOpenCreatePop:!1,isOpenInqueryPop:!1,prizeName:"",totalTurn:0,totalScore:0}),r=async({api:o,columnApi:a})=>{e.gridApi=o,e.colApi=a,await n()},n=async()=>{e.gridApi.showLoadingOverlay();const{data:o}=await b.searchPrizeName();e.rowData=o,o.length===0?e.gridApi.showNoRowsOverlay():e.gridApi.hideOverlay()},g=K(async o=>{_.isLoading=!0,e.gridApi.showLoadingOverlay();const{data:a}=await b.searchPrizeName(o!=null&&o.name?o.name:null);e.rowData=a,a.length===0?e.gridApi.showNoRowsOverlay():e.gridApi.hideOverlay(),_.isLoading=!1},500,{leading:!1,trailing:!0}),u=async()=>{var m;const o=(m=e.gridApi)==null?void 0:m.getSelectedRows(),a=R(o,t=>t.name);if(!(a.length<=0)){_.isLoading=!0;for(let t=0;t<a.length;t++)await b.deletePrize(a[t]);await n(),_.isLoading=!1}},i=({name:o,totalTurn:a,totalScore:m})=>{e.prizeName=o,e.totalTurn=a,e.totalScore=m,document.body.classList.add("overflow-hidden"),e.isOpenInqueryPop=!0},d=async()=>{e.prizeName="",e.totalTurn=0,e.totalScore=0,document.body.classList.remove("overflow-hidden"),e.isOpenCreatePop=!1,e.isOpenInqueryPop=!1,await n()};return(o,a)=>{const m=O("ag-grid-vue");return h(),P("div",oe,[s(Q,{ref_key:"refSearch",ref:y,onOnSearch:p(g),onOnCreate:a[0]||(a[0]=t=>e.isOpenCreatePop=!0),onOnDelete:u},null,8,["onOnSearch"]),f("div",ae,[s(m,{"default-col-def":{suppressMenu:!0,resizable:!0,sortable:!0},"column-defs":p(c).prizeList,"row-data":e.rowData,"row-selection":"multiple","stop-editing-when-cells-lose-focus":"",class:"ag-theme-quartz h-[400px] w-full","animate-rows":"","suppress-drag-leave-hides-columns":"","suppress-scroll-on-new-data":"","suppress-row-click-selection":"","row-multi-select-with-click":"",context:{openPop:i},"overlay-no-rows-template":p(c).overlay("noRows"),"overlay-loading-template":p(c).overlay("loading"),onGridReady:r},null,8,["column-defs","row-data","context","overlay-no-rows-template","overlay-loading-template"])]),e.isOpenCreatePop?(h(),D(Y,{key:0,onClose:d})):N("",!0),e.isOpenInqueryPop?(h(),D(te,{key:1,name:e.prizeName,"total-turn":+e.totalTurn,"total-score":+e.totalScore,onClose:d},null,8,["name","total-turn","total-score"])):N("",!0)])}}});export{ce as default};
